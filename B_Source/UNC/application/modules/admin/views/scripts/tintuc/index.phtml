<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js" type="text/javascript"></script>
<script type="text/javascript">
		function confirmDel(value)
				{
					var x;
					var r=confirm("Bạn muốn xóa tin tức này?");
					if (r==true)
					{
						var uri="<?php echo $this->baseUrl();?>/admin/tintuc/delete/newsid/"+value;
						window.location=uri;
					}
					else 
					{	
					}
				}
		

		/*function abc()
		{
			var listDel=document.getElementsByClassName('del_button');
			for (var i=0;i<listDel.length;i++)
			{
				var onclick=listDel[i].getAttribute("onclick");
				if (onclick=='confirmDel( )')
				{
					listDel[i].setAttribute("style","display:none");
				}
			}
		}*/
</script>
<style>
	.del_button{cursor:pointer}
</style>

<?php if (isset($_SESSION['result']))
{
	echo '<p class="message">';
	echo $_SESSION['result'];
	echo '</p>';
	unset($_SESSION['result']);
}
?>

<article class="module width_full" onload="abc()">
	<header><h3 style="width: 35%"><?php echo $this->title;?></h3>             
		<div id="subpage_search" style="padding-top:3px" >
            	<form class="search-form" action="<?php echo $this->baseUrl("admin/tintuc/timkiem");?>" method="post">
					<input name="search-text" class="t" onfocus="if (this.value == 'Tìm kiếm …') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Tìm kiếm …';}" type="text" value="Tìm kiếm …"/>
					<input class="searchsubmit" type="submit" value="Tìm kiếm" style="cursor:pointer; height: 21px; padding-bottom:1px"/>
					<select id="viewtype" onchange="return selectViewChange();" style="float: right">
						<option value="">Lọc theo ...</option>
						<option value="1">Xem tất cả</option>
						<option value="2">Những tin tức được xác nhận</option>
						<option value="3">Những tin tức chưa được xác nhận</option>
						<?php foreach($this->listCategories as $cat)
						{?>
							<option value="<?php echo 3+$cat['category_id'];?>"><?php echo $cat['category_name']?></option>	
						<?php }?>
					</select>
				</form>
				<script>
				function selectViewChange() {
					var go=$("#viewtype").val();
				  window.location = '<?php echo $this->baseUrl("admin/tintuc/index/viewtype/");?>'+go;
				}
				</script>				
            </div>
    </header>
    <div class="yui3-skin-sam">
			<div class="example yui3-skin-sam" id="listnews">
			</div>
		</div>
	<div class="tab_container">
		<script src="http://yui.yahooapis.com/3.7.2/build/yui/yui-min.js" type="text/javascript"></script>
		<script type="text/javascript">
			YUI().use("datatable-sort",'datatable','gallery-paginator-view', 'gallery-datatable-paginator', function (Y) {
				var data = [
											<?php 
													$count=0;
													foreach ($this->list as $item)
													{?>
														{ news_title: '<?php echo $item['news_title'];?>', 
															news_avatar: '<?php echo $item['news_avatar'];?>',
															news_summary: '<?php $summ= str_replace(array("\n", "\r"), ' ', strip_tags($item['news_summary']));
																			echo substr($summ, 0, 400);?>',   
															news_author: "<?php echo $item['news_author'];?>",
															news_modified_date: "<?php if ($item['news_modified_date']!='0000-00-00 00:00:00') echo $item['news_modified_date'];?>",
															news_status: "<?php echo $item['news_status'];?>",
															category_id: "<?php echo $this->categoriesid[$count]; ?>",
															is_hot : "<?php if($item['is_hot'] == "1") echo 'Có'; else echo 'Không'; ?>",
															optionedit: "<?php echo $item['news_id'];?>",
															optiondel: "<?php if ($item['news_author']!="") echo $item["news_id"]; else echo " ";?>"
														},
													<?php $count++;}?>
												];
				var pagModel = new Y.PaginatorModel({itemsPerPage:25});
				var cols=[{
								key: 'news_title',
								label: 'Tiêu đề',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true // Must be set or the html will be escaped
							},
							{
								key: 'news_avatar',
								label: 'Ảnh đại diện',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true 
							},
							{
								key: 'news_summary',
								label: 'Tóm tắt',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true 
							},
							{
								key: 'news_author',
								label: 'Tác giả',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true
							},
							{
								key: 'news_modified_date',
								label:'Ngày sửa',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true
							},
							{
								key: 'news_status',
								label:'Trạng thái',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true
							},
							{
								key: 'is_hot',
								label:'Tin hot',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true
							},
							{
								key: 'optiondel',
								label:'Xóa',
								formatter: '<a class="del_button" onclick="confirmDel({value})" title="Xóa"><img src="<?php echo $this->baseUrl();?>/application/templates/admin/images/icn_trash.png"></a>',
								allowHTML: true
							},
							{
								key: 'optionedit',
								label:'Sửa',
								formatter: '<a href="<?php echo $this->baseUrl();?>/admin/tintuc/edit/newsid/{value}" title="Sửa"><img src="<?php echo $this->baseUrl();?>/application/templates/admin/images/icn_edit.png"></a>',
								allowHTML: true
							}];
				var table = new Y.DataTable({
					columns: cols,
					data: data,
					paginator: new Y.PaginatorView({
			            model:          pagModel,
			            sortable: true,
			            dynamicData:true,
			            sortedBy : {key:"news_title"},
			            container:      '#pagContainerBar',
			            paginatorTemplate:  '<a href="#" data-pglink="first" class="{pageLinkClass}" title="First Page">First</a> | '+
                        '<a href="#" data-pglink="prev" class="{pageLinkClass}" title="Prior Page">Prev</a> | '+
                        '{pageLinks} | <a href="#" data-pglink="next" class="{pageLinkClass}" title="Next Page">Next</a> | '+
                        '<a href="#" data-pglink="last" class="{pageLinkClass}" title="Last Page">Last</a> &nbsp; Rows/Page: {selectRowsPerPage}'}),
			        resizePaginator: true
				});
	
				table.render("#listnews");
			});
		</script>
		<footer>
				<div class="submit_link" style="float:right">
					<a class="alt_btn" href="<?php echo $this->baseUrl('admin/tintuc/insert');?>">Thêm mới</a>
				</div>
				
				<div class="submit_link" style="float:left; font-weight: bold;">
					<!-- ?php echo $this->paginationControl($this->list,'Sliding','tintuc/pagination.phtml');? -->
					<div id="pagContainerBar" style="margin-top: 4px; margin-left:100px"></div>
				</div>
		</footer>
	</div>
</article>