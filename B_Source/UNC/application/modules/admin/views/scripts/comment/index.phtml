<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js" type="text/javascript"></script>
<script type="text/javascript">
		function confirmDel(value)
				{
					var x;
					var r=confirm("Bạn muốn xóa bình luận này ?");
					if (r==true)
					{
						var uri="<?php echo $this->baseUrl();?>/admin/comment/del/comment_id/"+value;
						window.location=uri;
					}
					else 
					{	
					}
				}
</script>
<style>
	.del_button{cursor:pointer}
	.yui3-datatable-table{width:100% !important}
</style>

<?php if (isset($_SESSION['result']))
{
	echo '<p class="message">';
	echo $_SESSION['result'];
	echo '</p>';
	unset($_SESSION['result']);
}
?>
<article class="module width_full">
	<header><h3><?php echo $this->title;?></h3></header>
	<div class="tab_container">
		
		<script src="http://yui.yahooapis.com/3.7.2/build/yui/yui-min.js" type="text/javascript"></script>
		
		<script type="text/javascript">
			YUI().use('datatable', function (Y) {
				var data = [
							<?php 
								$count=1;
								foreach ($this->list as $item)
								{
									?>
									{ 
										order: "<?php echo $count;?>", 
										comment_content: "<?php $content= str_replace(array("\n", "\r"), ' ', strip_tags($item['comment_content']));
														echo substr($content, 0, 400);?>",									
										news_id: "<?php 
											$string = $this->listNewsTitle[$count-1];
											$charset = 'utf-8';
											$len = 45;
											$string = html_entity_decode($string, ENT_QUOTES, $charset);
											if(mb_strlen($string, $charset)> $len)
											{
												$arr = explode(' ', $string);
												$string = mb_substr($string, 0, $len, $charset);
												$arrRes = explode(' ', $string);
												$last = $arr[count($arrRes)-1];
											
												unset($arr);
												if(strcasecmp($arrRes[count($arrRes)-1], $last))
												{
													unset($arrRes[count($arrRes)-1]);
												}
												$string = implode(' ', $arrRes)."...";
											}
											echo $string;
										 ?>",
										reader_id: "<?php echo $this->listReaderName[$count-1];?>",
										sua: "<?php echo $item['comment_id']?>",
										xoa: "<?php echo $item['comment_id']?>"
									},
							<?php $count++;}?>
							];
				
				var count=1;
				
				var table = new Y.DataTable({
					columns: [{
								key: 'order',
								label: 'Số thứ tự',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true
							},
							{
								key: 'comment_content',
								label: 'Nội dung bình luận',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true 
							},
							{
								key: 'news_id',
								label: 'Tin tức',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true
							},
							{
								key: 'reader_id',
								label:'Người đọc',
								sortable:true,
								formatter: '<span>{value}</span>',
								allowHTML: true
							},
							{
								key: 'sua',
								label:'<center>Sửa</center>',
								formatter: '<center><a href="<?php echo $this->baseUrl();?>/admin/comment/edit/comment_id/{value}" title="Edit"><img src="<?php echo $this->baseUrl();?>/application/templates/admin/images/icn_edit.png"></a></center>',
								allowHTML: true
							},
							{
								key: 'xoa',
								label:'<center>Xóa</center>',
								formatter: '<center><a class="del_button" onclick="confirmDel({value})" title="Del"><img src="<?php echo $this->baseUrl();?>/application/templates/admin/images/icn_trash.png"></a></center>',
								allowHTML: true
							}],
					data: data,
				});
	
				table.render("#listnews");
			});
		</script>
		<div class="yui3-skin-sam">
			<div class="example yui3-skin-sam" id="listnews">
			</div>
		</div>
		<footer>
			<div class="submit_link">
				<?php echo $this->paginationControl($this->list,
                                    'Sliding',
                                    'tintuc/pagination.phtml');?>
			</div>
		</footer>
	</div>
</article>